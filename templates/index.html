{% extends "base.html" %}
{% block content %}

    <!--SEARCH & SORT-->
    <div class="vm1 container mt1">
        <div class="row">
            <!--SEARCH-->
            {% if not query %}
                <form class="col s12 m6 xl4" action="{{ url_for('search', sort_by=sort_by, query=query) }}" method="post">
            {% else %}
                <form class="col s8" action="{{ url_for('search', sort_by=sort_by, query=query) }}" method="post">
            {% endif %}
                    <div class="input-field flex">
                        <input type="text" name="query" id="query" minlength="3" class="validate" required>
                        <label class="flex-space" for="query">Search Recipes</label>
                        <button id="search-button"  type="submit" class="transparent blue-grey-text text-darken-3 no-border"><i class="fas fa-search left"></i>
                        </button>
                    </div>
                </form>
            <!--SORT-->
            {% if not query %}
                <div class="input-field col s6 m3 xl4">
            {% else %}
                <div class="input-field col s4">
            {% endif %}
                {% if query %}
                    <!--sort results of a query-->
                    <form action="{{ url_for('sort_query', sort_by=sort_by, query=query) }}" method="POST" >
                {% elif filter_by %}
                    <!--sort results of a query-->
                    <form action="{{ url_for('sort_filter', filter_by=filter_by, sort_by=sort_by, query=query) }}" method="POST" >
                {% else %}
                    <!--sort all-->
                    <form action="{{ url_for('sort', filter_by=filter_by, sort_by=sort_by, query=query) }}" method="POST" >
                {% endif %}
                        <select id="sort_by" name="sort_by" onchange="this.form.submit()">
                            <!--Display sort preference if one is selected-->
                            {% if sort_by %}
                            <option value="" disabled selected>{{ sort_by }}</option>
                            {% else %}
                            <option value="" disabled selected>Sort By</option>
                            {% endif %}
                            <option value="A-Z">A-Z</option>
                            <option value="Z-A">Z-A</option>
                            <option value="Newest">Newest</option>
                            <option value="Oldest">Oldest</option>
                        </select>
                    </form>
                </div>
                <!--Option to filter category only if a search has not been made-->
                {% if not query %}
                    <!--FILTER-->
                    <div class="input-field col s6 m3 xl4">
                    {% if sort_by %}
                        <!--filter results of a query-->
                        <form action="{{ url_for('filter_sort', sort_by=sort_by) }}" method="POST" >
                    {% else %}
                        <!--sort all-->
                        <form action="{{ url_for('filter') }}" method="POST" >
                    {% endif %}
                            <select id="filter_by" name="filter_by" onchange="this.form.submit()">
                                <!--Display sort preference if one is selected-->
                                {% if filter_by %}
                                <option value="" disabled selected>{{ filter_by }}</option>
                                {% else %}
                                <option value="" disabled selected>Filter By</option>
                                {% endif %}
                                <option value="Cooking">Cooking</option>
                                <option value="Baking">Baking</option>
                                <option value="Snacks">Snacks</option>
                            </select>
                        </form>
                    </div>
                {% endif %}
            </div>
        </div>

        {% if number_of_all_rec > 0 %}
        <!--Recipe Cards-->
        <div class="row container">
            {% if query %}
            <h5 class="m-all center-align">{{ number_of_all_rec }} Results for {{ query }}</h5>
            {% elif filter_by %}
            <h5 class="m-all center-align">{{ number_of_all_rec }} Results for {{ filter_by }}</h5>
            {% endif %}
            {% for recipe in recipes %}
                {% include "partials/recipe_cards.html" %}
                {% include "partials/recipe_cards_lg.html" %}
            {% endfor %}
        </div>

        <!--PAGINATION-->
        <ul class="pagination center-align margin-bottom-large">
            <h5>{{ number_of_all_rec }} Recipes</h5>
            {% for page_num in pages %} 
                {% if page_num == current_page %}
                <li class="active"><a>{{ page_num }}</a></li>
                {% else %}
                <li class="waves-effect">
                    {% if title == 'McTastic Recipes' %}
                        <a href="{{ url_for('recipes', query=query, sort_by=sort_by, current_page=page_num) }}">{{ page_num }}</a>
                    {% elif title == 'McTastic Search' %}
                        <a href="{{ url_for('search', query=query, sort_by=sort_by, current_page=page_num) }}">{{ page_num }}</a>
                    {% elif title == 'McTastic Recipes Sort' %}
                        <a href="{{ url_for('sort', query=query, sort_by=sort_by, current_page=page_num) }}">{{ page_num }}</a>
                    {% elif title == 'McTastic Recipes Search Sort' %}
                        <a href="{{ url_for('sort_query', query=query, sort_by=sort_by, current_page=page_num) }}">{{ page_num }}</a>
                    {% elif title == 'McTastic Recipes Filter' %}
                        <a href="{{ url_for('filter', filter_by=filter_by, query=query, sort_by=sort_by, current_page=page_num) }}">{{ page_num }}</a>
                    {% elif title == 'McTastic Recipes Filter Sort' %}
                        <a href="{{ url_for('filter_sort', filter_by=filter_by, sort_by=sort_by, current_page=page_num) }}">{{ page_num }}</a>
                    {% elif title == 'McTastic Recipes Sort Filter' %}
                        <a href="{{ url_for('sort_filter', filter_by=filter_by, query=query, sort_by=sort_by, current_page=page_num) }}">{{ page_num }}</a>
                    {% endif %}
                </li>
                {% endif %} 
            {% endfor %}
        </ul>
        {% else %}
            <h3 class="center-align">No Results Found for {{ query }}</h3>
        {% endif %}

{% endblock %}